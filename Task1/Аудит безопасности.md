# Обзорный аудит безопасности (AS-IS)

## Идентификация и доступ
- Доменная аутентификация без многофакторной аутентификации (MFA).
- Отсутствует централизованная система управления идентификацией и доступом (IAM).
- Доступ к данным осуществляется через Excel-файлы и другие документы в общих сетевых папках.
- Не реализованы модели RBAC/ABAC и отсутствует сегрегация данных по пациентам (Row-Level Security, RLS не применяется).

## Хранение данных
- Данные хранятся в форматах Excel, JPG, PDF на сетевых шарах без шифрования.
- Режим резервного копирования не определён: отсутствуют гарантии шифрования, WORM-политик, ретенции.
- Не обеспечивается контроль версий и целостности данных.

## Передача данных
- Передача персональных и медицинских данных осуществляется по электронной почте с вложениями.
- Интеграции носят файловый характер (file-based).
- Использование TLS/mTLS не гарантировано.
- Отсутствует система предотвращения утечек данных (DLP).

## Обработка и анализ
- Данные для отчётности извлекаются непосредственно из Excel-файлов.
- Процессы деперсонификации или обезличивания персональных данных не реализованы.
- Возможна утечка продакшн-данных в непродакшн-среды.

## Логирование и мониторинг
- Отсутствует сквозной аудит доступа к персональным данным.
- Нет централизованного сбора и корреляции инцидентов (например, через SIEM или UEBA).
- Логи могут содержать персональные данные без маскировки или анонимизации.

## Управление жизненным циклом данных
- Не определены формализованные цели и сроки хранения персональных данных.
- Отсутствует процесс оперативного удаления или блокировки данных по запросу субъекта персональных данных.
- Не ведётся учёт согласий на обработку персональных данных.

## Регуляторика и соответствие
- Выявлены риски несоответствия требованиям:
    - **ФЗ‑152**: включая обработку спецкатегории данных (сведения о состоянии здоровья).
    - **ФЗ‑242**: требования к локализации персональных данных.
    - **ФЗ‑323**: нормы медицинской тайны.
    - Приказы **ФСТЭК России**: уровни защищённости ИСПДн, применение организационно-технических мер.
    - Требования к использованию **криптографических средств защиты информации**, где это необходимо.

## Дополнительно
- Секреты и пароли могут храниться в открытом виде в файлах и скриптах.
- Слабая сетевая сегментация.
- Нет контроля за печатью документов и использованием USB-носителей.
- Отсутствует политика классификации данных и система тегирования информации.

## 2. Сопоставление процессов с требованиями и практиками

### Таблица 2.1. Мэппинг требований и практик по процессам

| Процесс | Данные | Ключевые требования (примерно) | Базовые практики | Текущее состояние | Гап |
|--------|--------|-------------------------------|------------------|-------------------|-----|
| **Запись/карточки пациентов** | ПДн, контактные данные, опционально адрес/медсведения | 152‑ФЗ, 323‑ФЗ: медтайна, минимизация, согласие, локализация; аудит | SSO + MFA; RBAC/ABAC; шифрование at rest/in transit; RLS; неизменяемый аудит | Excel на шаре, email/телефон, без шифрования/ролей | **Критичный** |
| **Лаборатория (направления/результаты)** | Спецкатегория (результаты анализов) | 152‑ФЗ спецкат.; 323‑ФЗ; разграничение доступа по “пациент–врач/владелец” | Псевдонимизация; API с mTLS; доступ по тегам; аудит | Файлы/сканы, нет API, нет псевдонимов | **Критичный** |
| **Платежи/учёт** | Чеки, суммы, ссылки на услуги | Налоговое/кассовое; не хранить PAN/трек‑данные; целостность | TLS; разграничение ролей кассир/бухгалтер; шифрование выгрузок; аудит | Двойной учёт в Excel, неочевидный TLS | **Высокий** |
| **Почта/файлообмен** | Вложения с ПДн/медданными | 152‑ФЗ: защита каналов/ограничение распространения | DLP; замена вложений на ссылки; шифрование файлов | Свободная пересылка, нет DLP | **Критичный** |
| **ТМЦ/закупки** | Документы ТМЦ, без ПДн пациентов | Разделение доменов; шифрование; аудит | RBAC; TLS; бэкапы с шифрованием | 1С ↔ 1С; файлы на шаре | **Средний** |

# Проблемные зоны

- **Общая файловая шара с ПДн/медданными без шифрования/аудита** — риск массовой утечки (**критич.**)
- **Excel — основной источник истины для ПДн**: нет ролей, версионирования, аудита (**критич.**)
- **Почта с вложениями ПДн и результатами анализов; отсутствует DLP** (**критич.**)
- **Отсутствие централизованного IAM, MFA, управления сессиями** (**высок.**)
- **Нет модели классификации/тегов и ABAC/TBAC, нет RLS по `patient_id`** (**высок.**)
- **Интеграция с лабораторией — файловая, без API, без псевдонимизации** (**высок.**)
- **Бэкапы/дампы**: отсутствие подтверждённого шифрования, WORM, регламентов восстановления (**высок.**)
- **Отсутствие сквозного шифрования в транспорте** (mTLS внутри, TLS наружу) (**высок.**)
- **Нет централизованного аудита/логов и алертинга по доступам к ПДн** (**высок.**)
- **Прод‑данные попадают в непрод/BI без деперсонизации** (**высок.**)
- **Логи/трейсы содержат ПДн без маскировки** (**сред.**)
- **Секреты/пароли в конфигурациях/скриптах** (**сред.**)
- **Недостаточная сегментация сети и контроль периферии** (USB/печать) (**сред.**)
- **Отсутствуют процессы**: учёт согласий, прав субъекта ПДн, сроки хранения/удаление (**сред.**)
- **Непрозрачная работа ККМ–1С по шифрованию/целостности** (**сред.**)

## 4. Выявленные чувствительные данные, которые не учтены во внутренних системах

### Таблица 4.1. «Слепые зоны» данных

| Тип данных | Где возникает | Почему чувствительно | Риск |
|-----------|---------------|----------------------|------|
| Записи звонков / голосовые напоминания | Телефония / робот | ПДн / медтайна в речи | Утечка при хранении / пересылке |
| История уведомлений (SMS / мессенджеры) | Провайдеры SMS / WhatsApp | Идентификаторы, ссылки на приём | Неучтённые внешние хранители |
| Черновики писем и автосохранения | Почтовый сервер / клиенты | Копии вложений / ПДн | Обход DLP / утечки |
| Временные файлы сканеров / редакторов | Рабочие станции | Могут содержать сканы паспортов | Локальные утечки / форензика |
| Фото / сканы с личных устройств | Телефоны сотрудников | ПДн / медтайна | Неподконтрольный периметр |
| Журналы доступа (логи) | Сервисы / системы | Могут включать ФИО / телефон | Раскрытие ПДн в логах |
| Резервные копии / снэпшоты | Бэкап-хранилища | Полные дампы ПДн / PHI | Массовые утечки |
| Кеши и выгрузки BI / Excel | ПК сотрудников | ПДн / PHI в выгрузках | Размножение копий |
| Документы на печати | Принтеры / кэши | ПДн / анализы | Подбор отпечатков |
| Сеансовые токены / ключи | Браузеры / почта | Доступ к ЛК / сервисам | Угон сессий |

## 5. Список данных для защиты и методы (шифрование / обфускация / обезличивание)

### Таблица 5.1. Классификация и меры

| Категория | Примеры полей | Класс | At rest | In transit | В логах / непрод | Доступ (пример) | Retention / удаление |
|----------|----------------|--------|---------|------------|------------------|------------------|------------------------|
| **ПДн базовые** | ФИО, ДР, телефон, email, адрес | Confidential | Шифрование на уровне БД / файлов | TLS | Маскирование (например, `+7***`), удаление из логов | Роль: ресепшен / врач; RLS по `patient_id` | X лет после последнего визита, затем удаление / архив |
| **Спецкатегория (медицина)** | Диагноз, результаты анализов, назначения | Restricted / PHI | Шифрование, отдельный домен | TLS / mTLS | Полное исключение; для BI — обезличивание | Только врач / пациент; принцип *need-to-know* | По мед. нормам; аудит удаления |
| **Документы** | Паспорт, полис, договоры, согласия | Confidential | Шифрование объектов, контроль целостности | TLS | Хэши вместо образов; запрет в непрод | Ограниченный список ролей | До конца договора + законодат. срок |
| **Финансы** | Чеки, суммы, `receipt_id` | Internal / Conf. | Шифрование БД / выгрузок | TLS | Суммы без ПДн | Кассир / бухгалтер | По бух. срокам |
| **Секреты / ключи** | Пароли, токены | Restricted | HSM / KMS | TLS | Никогда не логировать | Админы по MFA / PAM | Политики ротации |
| **Логи** | Тех. события | Internal | Иммутабельное хранилище | TLS | Очистка ПДн / хеши | Без ПДн; доступ SRE / безопасность | 90–365 дн. согласно политике |
| **BI / ML датасеты** | Агрегаты, фичи | Internal | Шифрование датасетов | TLS | Обезличивание / агрегация | Аналитики; без прямых идентификаторов | По политике аналитики |

> **Примечание по обезличиванию**:  
> Для аналитики — удаление прямых идентификаторов, применение *k-анонимности*, псевдонимизация (с использованием стабильных токенов), генерализация дат и адресов.  
> Для тестовых сред — использование синтетических данных вместо реальных записей.

## 6. Механизм тегирования данных (vendor‑neutral)

### 6.1 Таксономия

- **Домены**: `patient`, `medical`, `billing`, `inventory`, `hr`, `security`, `logs`
- **Чувствительность**: `public`, `internal`, `confidential`, `restricted`
- **Категории ПДн**: `pii_basic`, `pii_special_medical`, `payment_ref`
- **Политики**: `no_email`, `audit_required`, `encrypt_at_rest`, `ru_only`, `retention_X` (например, `retention_5y`)

### 6.2 Правила присвоения тегов

- **Схемы БД / колонки**: тег фиксируется в метаданных схемы и автоматически наследуется в ETL-, BI- и ML-пайплайнах.
- **API**: поля в OpenAPI/Swagger-спецификациях помечаются тегами; внешние (публичные) API **не могут** возвращать поля с тегом `pii_special_medical`.
- **Файлы**: объектные хранилища поддерживают теги в метаданных; при наличии тега `no_email` отправка файла по email блокируется или заменяется защищённой ссылкой.
- **Логи**: по умолчанию присваивается тег `logs`; запрещено включение полей с тегами `pii_*` (требуется автоматическая очистка/маскировка на этапе логгирования).

### 6.3 Таблица “Тег → правило контроля”

| Тег | Назначение | Источник тега | Применение / правило |
|-----|------------|----------------|------------------------|
| `pii_basic` | ПДн общего уровня | Схема / автоклассификация | Маскирование по умолчанию; RLS по `patient_id` |
| `pii_special_medical` | Медицинская тайна | Схема / ручная маркировка | Доступ только ролям `care`; обязательный аудит всех операций |
| `payment_ref` | Финансовые референсы | Схема | Запрет хранения PAN; шифрование выгрузок и БД |
| `confidential` | Повышенная чувствительность | Политика | Запрет передачи через внешние каналы (email, мессенджеры) |
| `restricted` | Максимальная защита | Политика | Обязательна MFA; все доступы подлежат расследованию |
| `no_email` | Запрет почтовых вложений | Политика | DLP-система блокирует отправку или заменяет вложение защищённой ссылкой |
| `audit_required` | Обязательный аудит | Политика | Все операции записываются в неизменяемый аудит-журнал |
| `encrypt_at_rest` | Обязательное шифрование | Политика | Хранилища проверяются на наличие шифрования (TDE, AES и т.п.) |
| `ru_only` | Локализация данных в РФ | Политика | Блокировка кросс-регионального перемещения (например, в облака вне РФ) |
| `retention_X` | Срок хранения (например, `retention_5y`) | Политика | Автоматическое удаление или архивирование по истечении срока |

## 7. Что можно улучшить (без конкретных решений — тезисно)

- Ввести классификацию данных и теги, и на их основе строить политики доступа, хранения и передачи.
- Перевести критичные данные из файлов и Excel-таблиц в управляемые системы с поддержкой ролевого доступа (RBAC/ABAC), аудита и контроля целостности.
- Исключить передачу ПДн и медицинских данных через email и вложения; заменить на контролируемые, защищённые каналы с аутентификацией получателя.
- Внедрить псевдонимизацию при обмене данными с лабораторией и другими внешними контрагентами.
- Обеспечить сквозной аудит всех операций с ПДн и настроить алертинг по аномальным или массовым запросам.
- Формализовать сроки хранения персональных данных, а также процедуры удаления, блокировки и реализации прав субъекта ПДн.
- Внедрить надёжную деперсонификацию (обезличивание) для аналитических и BI-нагрузок и запретить использование продакшн-ПДн в непродакшн-средах.
## 8. «Доработка диаграмм текстом»: что использовать на каждом этапе потока

### Таблица 8.1. Запись пациента

| Этап | Данные | Риски | Контроли |
|------|--------|-------|----------|
| Пациент → ресепшен / портал | ПДн | Перехват, избыточный сбор | TLS, минимизация полей, капча, согласие с указанием целей обработки |
| Создание / чтение записи | ПДн | Неправомерный доступ | RBAC + ABAC, RLS по `patient_id`, аудит операций |
| Хранение карточки | ПДн | Утечка, несанкционированное изменение | Шифрование БД, бэкапы с WORM-политикой, журналирование изменений |
| Напоминания | Метаданные визита | Раскрытие ПДн | Использование шаблонов без ПДн, ссылки вместо данных, лог рассылок без персональных данных |

### Таблица 8.2. Лаборатория

| Этап | Данные | Риски | Контроли |
|------|--------|-------|----------|
| Создание направления | Идентификатор | Связка ФИО ↔ результат | Псевдонимизация (`order_id`), отдельная защищённая таблица соответствий |
| Передача в лабораторию | Спецкатегория | Перехват при передаче | mTLS, минимизация передаваемых полей |
| Получение результатов | Файлы / HL7 | Утечка данных | Объектные теги (`PHI`, `no_email`), шифрование объектов, антивирусный скан |
| Доступ врача / пациента | PHI | Доступ посторонних | ABAC (врач ↔ пациент), аудит доступа, короткоживущие ссылки |

### Таблица 8.3. Платежи

| Этап | Данные | Риски | Контроли |
|------|--------|-------|----------|
| Оплата / чек | Финансы | Компрометация платёжных данных | Не хранить PAN; TLS; сегрегация ролей (кассир / бухгалтер) |
| Учёт в системе | Референсы | Несанкционированный доступ | RBAC, шифрование данных, аудит операций |
| Выгрузки / отчёты | Финансовые данные | Утечки через файлы | Шифрование выгрузок, DLP, строгий контроль доступа |

### Таблица 8.4. Почта / файлообмен

| Этап | Данные | Риски | Контроли |
|------|--------|-------|----------|
| Отправка документов | ПДн / PHI | Утечки при пересылке | DLP, запрет вложений с тегом `no_email`, замена на защищённые ссылки с TTL |
| Хранение файлов | Сканы, документы | Массовая утечка | Объектные теги, шифрование, иммутабельное хранилище, аудит доступа |

### Таблица 8.5. ТМЦ

| Этап | Данные | Риски | Контроли |
|------|--------|-------|----------|
| Документы ТМЦ | Накладные, спецификации | Перемешивание доменов (ТМЦ ↔ ПДн) | Сегрегация доменов, RBAC, шифрование бэкапов |
| Интеграция 1С | Движение ТМЦ | Перехват данных | TLS, аудит обменов, контроль целостности |